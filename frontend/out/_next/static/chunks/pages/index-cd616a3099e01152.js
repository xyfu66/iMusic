(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{4287:(e,t,r)=>{"use strict";r.d(t,{X:()=>a});let a=(0,r(5664).eU)({key:"practiceState",default:null})},4590:(e,t,r)=>{"use strict";r.d(t,{Ic:()=>d,WW:()=>c,pt:()=>o,w8:()=>n,y4:()=>s});var a=r(5364);let s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{let r=atob(e),a=r.length,s=new Uint8Array(a);for(let e=0;e<a;e++)s[e]=r.charCodeAt(e);return new Blob([s],{type:t})}catch(e){return console.error("Failed to decode Base64 data:",e),null}},l=()=>("Android"===i()||a.env.NEXT_CLOUD_BACKEND_URL,"http://192.168.68.58:8101/cloud"),i=()=>{let e=navigator.userAgent||navigator.vendor;return/windows phone/i.test(e)?"Windows Phone":/android/i.test(e)?"Android":/iPad|iPhone|iPod/.test(e)?"iOS":/Macintosh|MacIntel|MacPPC|Mac68K/.test(e)?"Mac":/Win32|Win64|Windows|WinCE/.test(e)?"Windows":"Unknown"},n=(e,t)=>"score"===t?"".concat(l(),"/get-score-file-by-id/").concat(e):"audio"===t?"".concat(l(),"/get-audio-file-by-id/").concat(e):"midi"===t?"".concat(l(),"/get-midi-file-by-id/").concat(e):"";var o=function(e){return e.SCORE="score",e.AUDIO="audio",e.MIDI="midi",e}({});let c=l(),d=("Android"===i()?"http://10.0.2.2:8201":a.env.NEXT_LOCAL_BACKEND_URL||"http://localhost:8201")+"/local"},6760:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(8493)}])},8493:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>C});var a=r(7876),s=r(4232),l=r(4590);let i={fetchLibrary:async()=>{try{let e=await fetch("".concat(l.WW,"/library")),t=await e.json();if(t.success)return t.data;throw Error(t.message||"获取乐谱库失败")}catch(e){throw console.error("Error fetching library:",e),e}},fetchMyLibrary:async()=>{try{let e=await fetch("".concat(l.WW,"/my-library"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),t=await e.json();if(t.success)return t.data;throw Error(t.message||"获取我的乐谱失败")}catch(e){throw console.error("Error fetching my library:",e),e}},deleteFile:async e=>{try{let t=await fetch("".concat(l.WW,"/delete/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),r=await t.json();if(r.success)return!0;throw Error(r.message||"删除乐谱失败")}catch(e){throw console.error("Error deleting file:",e),e}},fetchPracticeData:async e=>{try{let t=await fetch("".concat(l.WW,"/practice/").concat(e),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),r=await t.json();if(r.success)return r.data;throw Error(r.message||"获取练习数据失败")}catch(e){throw console.error("Error fetching practice data:",e),e}}};var n=r(9099),o=r(5664),c=r(4287);let d=e=>{let{file:t,type:r,onDelete:s}=e,d=(0,n.useRouter)(),[u,h]=(0,o.L4)(c.X),m=async()=>{try{let e=await i.fetchPracticeData(t.id);h({useUrl:e.use_url?"true":"false",fileInfo:e.file_info,fileContent:e.file_content,midiContent:e.midi_content,audioContent:e.audio_content,fileUrl:e.file_url,midiUrl:e.midi_url,audioUrl:e.audio_url}),d.push("/PracticePage")}catch(e){alert("获取练习数据失败")}},x=async e=>{if(e.stopPropagation(),window.confirm("确定要删除这个乐谱吗？"))try{await i.deleteFile(t.id),s&&s(),alert("删除成功")}catch(e){alert("删除失败")}},f=async()=>{try{let e=await fetch("".concat(l.WW,"/update-visibility"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({file_id:t.id,is_public:!t.is_public})});e.ok||(alert("更新可见性失败"),console.log("更新可见性失败"+e.status));let r=await e.json();r.success?(t.is_public=!t.is_public,s&&s()):console.error("Failed to update visibility:",r.message)}catch(e){console.error("Error updating visibility:",e)}};return(0,a.jsxs)("div",{className:"group relative bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 overflow-hidden file-card",children:[(0,a.jsxs)("div",{className:"p-4 cursor-pointer",children:[(0,a.jsxs)("div",{onClick:m,children:[(0,a.jsx)("h3",{className:"font-bold text-lg mb-2 truncate",children:t.filename}),(t.created_at||t.uploaded_at)&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 mb-1",children:["上传时间: ",new Date(t.created_at||t.uploaded_at||"").toLocaleString()]}),"library"===r&&t.username&&(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["上传者: ",t.username]})]}),(0,a.jsx)("div",{children:"myLibrary"===r&&(0,a.jsx)("div",{className:"flex items-center justify-between mt-2",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"状态:"}),(0,a.jsx)("button",{onClick:f,className:"relative inline-flex items-center h-6 rounded-full w-11 transition-colors duration-200 ease-in-out focus:outline-none ".concat(t.is_public?"bg-green-500":"bg-gray-300"),children:(0,a.jsx)("span",{className:"inline-block w-4 h-4 transform rounded-full bg-white transition-transform duration-200 ease-in-out ".concat(t.is_public?"translate-x-6":"translate-x-1")})}),(0,a.jsx)("span",{className:"text-sm ".concat(t.is_public?"text-green-600":"text-gray-600"),children:t.is_public?"公开":"私有"})]})})})]}),"myLibrary"===r&&(0,a.jsx)("button",{onClick:x,className:"absolute top-2 right-2 p-2 text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})},u=(0,s.forwardRef)((e,t)=>{let{onShowMore:r}=e,l=(0,s.useRef)(null),[n,o]=(0,s.useState)(5),[c,u]=(0,s.useState)([]),[h,m]=(0,s.useState)(!0),x=async()=>{try{m(!0);let e=await i.fetchLibrary();u(e)}catch(e){console.error("Error fetching library:",e)}finally{m(!1)}};if((0,s.useImperativeHandle)(t,()=>({fetchLibrary:x})),(0,s.useEffect)(()=>{x()},[]),(0,s.useEffect)(()=>{let e=()=>{if(l.current){let e=l.current.offsetWidth,t=l.current.querySelector(".file-card");o(Math.max(1,Math.floor((e+16)/((t?t.getBoundingClientRect().width:200)+16))))}};return setTimeout(e,100),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),h)return(0,a.jsx)("div",{className:"flex justify-center items-center h-48",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})});if(0===c.length)return(0,a.jsx)("div",{className:"flex justify-center items-center h-48 text-gray-500",children:"暂无乐谱，请上传文件。"});let f=c.slice(0,n);return(0,a.jsx)("div",{className:"flex-1 bg-gray-100 p-6",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Library"}),c.length>n&&r&&(0,a.jsxs)("button",{onClick:r,className:"text-blue-600 hover:text-blue-800 font-medium flex items-center gap-1",children:["显示更多",(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})]})]}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("div",{className:"overflow-hidden",children:(0,a.jsx)("div",{ref:l,children:(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 auto-rows-min",children:f.map(e=>(0,a.jsx)(d,{file:e,type:"library"},e.id))})})})})]})})});u.displayName="LibraryGrid";let h=e=>{let{onUploadComplete:t}=e,[r,i]=(0,s.useState)(null),[n,o]=(0,s.useState)(!0),[c,d]=(0,s.useState)(!1),u=async()=>{if(!r)return void alert("请选择文件");d(!0);try{let e=new FormData;e.append("file",r),e.append("is_public",n.toString());let a=await fetch("".concat(l.WW,"/upload"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:e}),s=await a.json();if(s.success){alert("上传成功"),i(null),o(!0);let e=document.querySelector('input[type="file"]');e&&(e.value=""),t()}else alert("上传失败："+(s.message||"未知错误"))}catch(e){console.error("上传错误:",e),alert("上传失败，请重试")}finally{d(!1)}};return(0,a.jsxs)("div",{className:"p-4 border rounded-lg bg-white shadow w-full",children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-4",children:"上传新乐谱"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("input",{type:"file",accept:".xml,.musicxml",onChange:e=>{e.target.files&&e.target.files.length>0&&i(e.target.files[0])},className:"block w-full text-sm text-gray-500   file:mr-4 file:py-2 file:px-4   file:rounded-full file:border-0   file:text-sm file:font-semibold   file:bg-blue-50 file:text-blue-700   hover:file:bg-blue-100"})}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"isPublic",checked:n,onChange:e=>o(e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,a.jsx)("label",{htmlFor:"isPublic",className:"ml-2 block text-sm text-gray-700",children:"设为公开"})]}),(0,a.jsx)("button",{onClick:u,disabled:c,className:"w-full px-4 py-2 rounded-md text-white font-medium\n            ".concat(c?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"),children:c?"上传中...":"上传"})]})]})},m=(0,s.forwardRef)((e,t)=>{let{onShowMore:r,onUploadComplete:l,onDelete:n}=e,o=(0,s.useRef)(null),[c,u]=(0,s.useState)(5),[m,x]=(0,s.useState)([]),[f,g]=(0,s.useState)(!0),p=async()=>{try{g(!0);let e=await i.fetchMyLibrary();x(e)}catch(e){console.error("Error fetching my library:",e)}finally{g(!1)}};if((0,s.useImperativeHandle)(t,()=>({fetchMyLibrary:p})),(0,s.useEffect)(()=>{p()},[]),(0,s.useEffect)(()=>{let e=()=>{if(o.current){let e=o.current.offsetWidth,t=o.current.querySelector(".file-card");u(Math.max(1,Math.floor((e+16)/((t?t.getBoundingClientRect().width:200)+16))))}};return setTimeout(e,100),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),f)return(0,a.jsx)("div",{className:"flex justify-center items-center h-48",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})});let y=m.slice(0,c);return(0,a.jsx)("div",{className:"flex-1 bg-gray-50 p-6",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"My Library"}),0!==m.length&&m.length>c&&r&&(0,a.jsxs)("button",{onClick:r,className:"text-blue-600 hover:text-blue-800 font-medium flex items-center gap-1",children:["显示更多",(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})]})]}),(0,a.jsxs)("div",{className:"flex gap-6",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[0===m.length&&(0,a.jsx)("div",{className:"flex justify-center items-center h-48 text-gray-500",children:"暂无乐谱，请上传文件。"}),(0,a.jsx)("div",{className:"overflow-hidden",children:(0,a.jsx)("div",{ref:o,children:(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 auto-rows-min",children:y.map(e=>(0,a.jsx)(d,{file:e,type:"myLibrary",onDelete:()=>n()},e.id))})})})]}),(0,a.jsx)("div",{className:"w-80",children:(0,a.jsx)(h,{onUploadComplete:()=>{l&&l()}})})]})]})})});m.displayName="MyLibraryGrid";let x=async(e,t)=>(await fetch("".concat(l.WW,"/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})})).json(),f=async(e,t,r)=>(await fetch("".concat(l.WW,"/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,username:r})})).json();var g=r(9764),p=r(1663);let y=e=>{let{isOpen:t,onClose:r,title:l,children:i}=e;return(0,a.jsx)(g.e,{appear:!0,show:t,as:s.Fragment,children:(0,a.jsxs)(p.lG,{as:"div",className:"relative z-10",onClose:r,children:[(0,a.jsx)(g.e.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:(0,a.jsx)(g.e.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,a.jsxs)(p.lG.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all",children:[(0,a.jsx)(p.lG.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:l}),(0,a.jsx)("div",{className:"mt-4",children:i}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("button",{type:"button",className:"inline-flex justify-center rounded-md border border-transparent bg-blue-100 px-4 py-2 text-sm font-medium text-blue-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2",onClick:r,children:"Close"})})]})})})})]})})},b=(0,o.eU)({key:"userState",default:{userId:null,username:null,token:null,roles:[],permissions:[],isLoggedIn:!1}}),j=()=>{let[e,t]=(0,o.L4)(b);return(0,s.useEffect)(()=>{let e=localStorage.getItem("userState");e&&t(JSON.parse(e))},[]),[e,t]},w=e=>{let{isOpen:t,onClose:r}=e,[l,i]=(0,s.useState)(""),[n,o]=(0,s.useState)(""),[c,d]=j(),u=async e=>{e.preventDefault();try{let e=await x(l,n);if(e.success){let{userId:t,username:a,token:s,roles:l,permissions:i}=e.data;localStorage.setItem("token",s),d({userId:t,username:a,token:s,roles:l,permissions:i,isLoggedIn:!0}),r()}else alert("Login failed")}catch(e){console.error("Error during login:",e),alert("Login failed. Please try again.")}};return(0,a.jsx)(y,{isOpen:t,onClose:r,title:"Login",children:(0,a.jsxs)("form",{onSubmit:u,children:[(0,a.jsx)("input",{type:"email",placeholder:"Email",value:l,onChange:e=>i(e.target.value),required:!0,className:"w-full p-2 border rounded mb-2"}),(0,a.jsx)("input",{type:"password",placeholder:"Password",value:n,onChange:e=>o(e.target.value),required:!0,className:"w-full p-2 border rounded mb-2"}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-green-500 text-white px-4 py-2 rounded",children:"Login"})]})})},v=e=>{let{isOpen:t,onClose:r}=e,[l,i]=(0,s.useState)(""),[n,o]=(0,s.useState)(""),[c,d]=(0,s.useState)(""),u=async e=>{e.preventDefault();try{let e=await f(l,n,c);e.success?(alert("Registration successful!"),r()):alert(e.detail||"Registration failed. Please try again.")}catch(e){console.error("Error during registration:",e),alert("Registration failed. Please try again.")}};return(0,a.jsx)(y,{isOpen:t,onClose:r,title:"Register",children:(0,a.jsxs)("form",{onSubmit:u,children:[(0,a.jsx)("input",{type:"email",placeholder:"Email",value:l,onChange:e=>i(e.target.value),required:!0,className:"w-full p-2 border rounded mb-2"}),(0,a.jsx)("input",{type:"password",placeholder:"Password",value:n,onChange:e=>o(e.target.value),required:!0,className:"w-full p-2 border rounded mb-2"}),(0,a.jsx)("input",{type:"text",placeholder:"Username",value:c,onChange:e=>d(e.target.value),required:!0,className:"w-full p-2 border rounded mb-2"}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-blue-500 text-white px-4 py-2 rounded",children:"Register"})]})})},N=e=>{let{isOpen:t,onClose:r,title:i,type:n,onRefresh:o}=e,[c,u]=(0,s.useState)([]),[h,m]=(0,s.useState)(1),[x,f]=(0,s.useState)(1),[g,p]=(0,s.useState)(!1);(0,s.useEffect)(()=>{t&&y(h)},[t,h]);let y=async e=>{p(!0);try{let t="library"===n?"".concat(l.WW,"/library?page=").concat(e,"&page_size=").concat(10):"".concat(l.WW,"/my-library?page=").concat(e,"&page_size=").concat(10),r=await fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),a=await r.json();a.success&&(u(a.data),f(a.pagination.total_pages))}catch(e){console.error("Error fetching files:",e)}finally{p(!1)}};return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:i}),(0,a.jsx)("button",{onClick:()=>{o&&o(),r()},className:"text-gray-500 hover:text-gray-700",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),g?(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):0===c.length?(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:"library"===n?"暂无乐谱，请上传文件。":"您还没有上传任何乐谱。"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:c.map(e=>(0,a.jsx)(d,{file:e,type:n,onDelete:()=>{y(h)}},e.id))})}),x>1&&(0,a.jsxs)("div",{className:"flex justify-center mt-4 space-x-2",children:[(0,a.jsx)("button",{onClick:()=>m(e=>Math.max(1,e-1)),disabled:1===h,className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",children:"上一页"}),(0,a.jsxs)("span",{className:"px-4 py-2",children:["第 ",h," 页 / 共 ",x," 页"]}),(0,a.jsx)("button",{onClick:()=>m(e=>Math.min(x,e+1)),disabled:h===x,className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",children:"下一页"})]})]})]})}):null},C=()=>{let e=(0,n.useRouter)(),[t,r]=j(),[i,o]=(0,s.useState)(!1),[c,d]=(0,s.useState)(!1),[h,x]=(0,s.useState)(!1),[f,g]=(0,s.useState)(!1),p=(0,s.useRef)(null),y=(0,s.useRef)(null);(0,s.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token");if(e)try{let t=await fetch("".concat(l.WW,"/auth/validate-token"),{headers:{Authorization:"Bearer ".concat(e)}}),a=await t.json();a.success?r({userId:a.data.userId,username:a.data.username,token:e,roles:a.data.roles,permissions:a.data.permissions,isLoggedIn:!0}):(localStorage.removeItem("token"),r({userId:null,username:null,token:null,roles:[],permissions:[],isLoggedIn:!1}))}catch(e){console.error("Error validating token:",e)}})()},[r]);let b=()=>{p.current&&p.current.fetchLibrary(),y.current&&y.current.fetchMyLibrary()};return(0,a.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,a.jsxs)("header",{className:"flex justify-between items-center p-4 bg-gray-800 text-white",children:[(0,a.jsx)("h1",{className:"text-xl font-bold",children:"Score Following App"}),(0,a.jsx)("div",{children:t.isLoggedIn?(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("span",{children:["Welcome, ",t.username]}),(0,a.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),r({userId:null,username:null,token:null,roles:[],permissions:[],isLoggedIn:!1}),e.replace("/")},className:"bg-red-500 text-white px-4 py-2 rounded",children:"Logout"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>x(!0),className:"mr-4 bg-blue-500 text-white px-4 py-2 rounded",children:"Register"}),(0,a.jsx)("button",{onClick:()=>g(!0),className:"bg-green-500 text-white px-4 py-2 rounded",children:"Login"})]})})]}),(0,a.jsx)(w,{isOpen:f,onClose:()=>g(!1)}),(0,a.jsx)(v,{isOpen:h,onClose:()=>x(!1)}),(0,a.jsxs)("div",{className:"flex justify-center space-x-4 py-4 bg-gray-100",children:[(0,a.jsx)("button",{onClick:()=>e.push("/TunerMetronome?tab=Tuner"),className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition",children:"\uD83C\uDFB5 调音器"}),(0,a.jsx)("button",{onClick:()=>e.push("/TunerMetronome?tab=Metronome"),className:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition",children:"⏱️ 节拍器"})]}),(0,a.jsx)(u,{ref:p,onShowMore:()=>o(!0)}),t.isLoggedIn&&(0,a.jsx)(m,{ref:y,onShowMore:()=>d(!0),onUploadComplete:b,onDelete:b}),(0,a.jsx)(N,{isOpen:i,onClose:()=>o(!1),title:"乐谱库",type:"library",onRefresh:b}),(0,a.jsx)(N,{isOpen:c,onClose:()=>d(!1),title:"我的乐谱",type:"myLibrary",onRefresh:b})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[595,663,636,593,792],()=>t(6760)),_N_E=e.O()}]);